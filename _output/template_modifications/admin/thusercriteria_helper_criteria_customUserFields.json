{
    "template": "helper_criteria",
    "description": "Add additional custom user field criteria.",
    "execution_order": 15,
    "enabled": true,
    "action": "preg_replace",
    "find": "/(<xf:foreach loop=\"\\$customFields\".*>.*<\\/xf:option>)(\\s*<\\/xf:checkboxrow>)/sU",
    "replace": "$1\n<xf:if is=\"true\">\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_checked_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" selected=\"{$criteria.{$fieldName}}\" value=\"{$fieldName}\" label=\"{{ phrase('thusercriteria_has_value') }}\"/>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_unchecked_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" selected=\"{$criteria.{$fieldName}}\" value=\"{$fieldName}\" label=\"{{ phrase('thusercriteria_has_no_value') }}\"/>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_preg-match_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_preg_matches:') }}\">\n\t\t<xf:textbox name=\"user_criteria[{$fieldName}][data][regex]\" value=\"{$criteria.{$fieldName}.regex}\" />\n\t</xf:option>\n</xf:if>\n\n<xf:if is=\"$fieldDefinition.match_type == 'number'\">\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_radio-below_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_value_is_below:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][threshold]\" value=\"{$criteria.{$fieldName}.threshold}\" size=\"5\" step=\"{{ $fieldDefinition.match_params.number_integer ? '1' : 'any' }}\" />\n\t</xf:option>\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_radio-above_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_value_is_above:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][threshold]\" value=\"{$criteria.{$fieldName}.threshold}\" size=\"5\" step=\"{{ $fieldDefinition.match_params.number_integer ? '1' : 'any' }}\" />\n\t</xf:option>\n</xf:if>\n\n<xf:if is=\"$fieldDefinition.match_type == 'url'\">\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_url-http_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\"\n\t\t\t   selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_url_is_http') }}\" />\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_url-https_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\"\n\t\t\t   selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_url_is_https') }}\" />\n\t\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_url-tld_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\"\n\t\t\t   selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_top_level_domain_one_of') }}\"\n\t\t\t   hint=\"{{ phrase('thusercriteria_multiple_values_may_be_separated_by_comma')}}\">\n\t\t<xf:textbox name=\"user_criteria[{$fieldName}][data][domains]\"\n\t\t\t\t\tvalue=\"{$criteria.{$fieldName}.domains}\" />\n\t</xf:option>\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_url-not-tld_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\"\n\t\t\t   selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_top_level_domain_not_one_of') }}\"\n\t\t\t   hint=\"{{ phrase('thusercriteria_multiple_values_may_be_separated_by_comma')}}\">\n\t\t<xf:textbox name=\"user_criteria[{$fieldName}][data][domains]\"\n\t\t\t\t\tvalue=\"{$criteria.{$fieldName}.domains}\" />\n\t</xf:option>\n</xf:if>\n\n<xf:if is=\"$fieldDefinition.match_type == 'email'\">\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_email-domain_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_domain_is:') }}\">\n\t\t<xf:textbox name=\"user_criteria[{$fieldName}][data][text]\" value=\"{$criteria.{$fieldName}.text}\" />\n\t</xf:option>\n</xf:if>\n\n<xf:if is=\"$fieldDefinition.match_type == 'color'\">\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_color-red-above_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_color_red_above:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][value]\" value=\"{$criteria.{$fieldName}.value}\" size=\"5\" min=\"0\" max=\"255\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_color-red-below_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_color_red_below:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][value]\" value=\"{$criteria.{$fieldName}.value}\" size=\"5\" min=\"0\" max=\"255\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_color-green-above_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_color_green_above:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][value]\" value=\"{$criteria.{$fieldName}.value}\" size=\"5\" min=\"0\" max=\"255\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_color-green-below_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_color_green_below:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][value]\" value=\"{$criteria.{$fieldName}.value}\" size=\"5\" min=\"0\" max=\"255\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_color-blue-above_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_color_blue_above:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][value]\" value=\"{$criteria.{$fieldName}.value}\" size=\"5\" min=\"0\" max=\"255\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_color-blue-below_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_color_blue_below:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][value]\" value=\"{$criteria.{$fieldName}.value}\" size=\"5\" min=\"0\" max=\"255\" step=\"1\" />\n\t</xf:option>\n</xf:if>\n\n<xf:if is=\"$fieldDefinition.match_type == 'date'\">\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-days-past_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_date_at_least_x_days_in_the_past:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][days]\" value=\"{$criteria.{$fieldName}.days}\" size=\"5\" step=\"1\" />\n\t</xf:option>\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-max-days-past_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_date_no_more_than_x_days_in_the_past:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][days]\" value=\"{$criteria.{$fieldName}.days}\" size=\"5\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-days-future_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_date_at_least_x_days_in_the_future:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][days]\" value=\"{$criteria.{$fieldName}.days}\" size=\"5\" step=\"1\" />\n\t</xf:option>\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-max-days-future_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_date_no_more_than_x_days_in_the_future:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][days]\" value=\"{$criteria.{$fieldName}.days}\" size=\"5\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-day-equals_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_day_equals:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][day]\" value=\"{$criteria.{$fieldName}.day}\" size=\"5\" min=\"1\" max=\"31\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-month-equals_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_month_equals:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][month]\" value=\"{$criteria.{$fieldName}.month}\" size=\"5\" min=\"1\" max=\"12\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-year-equals_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_year_equals:') }}\">\n\t\t<xf:numberbox name=\"user_criteria[{$fieldName}][data][year]\" value=\"{$criteria.{$fieldName}.year}\" size=\"5\" min=\"1\" max=\"2200\" step=\"1\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-before_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_date_before:') }}\">\n\t\t<xf:dateinput name=\"user_criteria[{$fieldName}][data][date]\" value=\"{$criteria.{$fieldName}.date}\" />\n\t</xf:option>\n\n\t<xf:set var=\"$fieldName\" value=\"{$xf.options.thusercriteria_prefix}user_field_date-after_{$fieldId}\" />\n\t<xf:option name=\"user_criteria[{$fieldName}][rule]\" value=\"{$fieldName}\" selected=\"{$criteria.{$fieldName}}\" label=\"{{ phrase('thusercriteria_date_after:') }}\">\n\t\t<xf:dateinput name=\"user_criteria[{$fieldName}][data][date]\" value=\"{$criteria.{$fieldName}.date}\" />\n\t</xf:option>\n</xf:if>\n$2"
}